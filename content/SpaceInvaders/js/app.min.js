var game={onload:function(){me.video.init(640,480,{parent:"screen",scale:"auto"})?(me.audio.init("mp3,ogg"),me.loader.preload(game.resources,this.loaded.bind(this))):alert("Your browser does not support HTML5 canvas.")},loaded:function(){me.pool.register("player",game.Player),me.pool.register("enemy",game.Enemy),me.pool.register("laser",game.Laser),this.playScreen=new game.PlayScreen,me.state.set(me.state.PLAY,this.playScreen),me.state.change(me.state.PLAY)},resources:[{name:"player",type:"image",src:"data/img/player.png"},{name:"ships",type:"image",src:"data/img/ships.png"}]};game.EnemyManager=me.Container.extend({init:function(){me.Container.prototype.init.apply(this,[0,32,64*this.COLS-32,64*this.ROWS-32]),this.COLS=9,this.ROWS=4,this.vel=16,this.onChildChange=function(){this.updateChildBounds(),0===this.children.length&&game.playScreen.reset()}},createEnemies:function(){for(var e=0;e<this.COLS;e++)for(var t=0;t<this.ROWS;t++)this.addChild(me.pool.pull("enemy",64*e,64*t));this.createdEnemies=!0},onActivateEvent:function(){var t=this;this.timer=me.timer.setInterval(function(){var e=t.childBounds;0<t.vel&&e.right+t.vel>=me.game.viewport.width||t.vel<0&&e.left+t.vel<=0?(t.vel*=-1,t.pos.y+=16,0<t.vel?t.vel+=5:t.vel-=5,game.playScreen.checkIfLoss(e.bottom)):t.pos.x+=t.vel},1e3)},onDeactivateEvent:function(){me.timer.clearInterval(this.timer),console.log("destroyed!")},update:function(e){me.Container.prototype.update.apply(this,[e]),this.updateChildBounds()}}),game.Enemy=me.Entity.extend({init:function(e,t){me.Entity.prototype.init.apply(this,[e,t,{image:"ships",width:32,height:32}]),this.chooseShipImage(),this.body.setVelocity(0,0),this.body.collisionType=me.collision.types.ENEMY_OBJECT},chooseShipImage:function(){var e=~~(3*Math.random());this.renderable.addAnimation("idle",[e],1),this.renderable.setCurrentAnimation("idle")},update:function(e){return me.Entity.prototype.update.apply(this,[e]),this.body.update(),!0}}),game.Laser=me.Entity.extend({init:function(e,t){me.Entity.prototype.init.apply(this,[e,t,{width:game.Laser.width,height:game.Laser.height}]),this.z=5,this.body.setVelocity(0,300),this.body.collisionType=me.collision.types.PROJECTILE_OBJECT,this.renderable=new(me.Renderable.extend({init:function(){me.Renderable.prototype.init.apply(this,[0,0,game.Laser.width,game.Laser.height])},destroy:function(){},draw:function(e){var t=e.getColor();e.setColor("#5EFF7E"),e.fillRect(0,0,this.width,this.height),e.setColor(t)}})),this.alwaysUpdate=!0},onCollision:function(e,t){if(t.body.collisionType===me.collision.types.ENEMY_OBJECT)return me.game.world.removeChild(this),game.playScreen.enemyManager.removeChild(t),!1},update:function(e){return this.body.vel.y-=this.body.accel.y*e/1e3,this.pos.y+this.height<=0&&me.game.world.removeChild(this),this.body.update(),me.collision.check(this),!0}}),game.Laser.width=5,game.Laser.height=28,game.Player=me.Sprite.extend({init:function(){var e=me.loader.getImage("player");me.Sprite.prototype.init.apply(this,[me.game.viewport.width/2-e.width/2,me.game.viewport.height-e.height-20,{image:e}]),this.velx=480,this.maxX=me.game.viewport.width-this.width},update:function(e){return me.Sprite.prototype.update.apply(this,[e]),me.input.isKeyPressed("left")&&(this.pos.x-=this.velx*e/1e3),me.input.isKeyPressed("right")&&(this.pos.x+=this.velx*e/1e3),me.input.isKeyPressed("shoot")&&(console.log("shoot!!"),me.game.world.addChild(me.pool.pull("laser",this.pos.x-game.Laser.width,this.pos.y-game.Laser.height))),this.pos.x=me.Math.clamp(this.pos.x,0,this.maxX),!0}}),game.resources=[{name:"player",type:"image",src:"data/img/player.png"},{name:"ships",type:"image",src:"data/img/ships.png"}],game.PlayScreen=me.Stage.extend({checkIfLoss:function(e){e>=this.player.pos.y&&this.reset()},onResetEvent:function(){me.game.world.addChild(new me.ColorLayer("background","#000000"),0),this.player=me.pool.pull("player"),me.game.world.addChild(this.player,1),this.enemyManager=new game.EnemyManager,this.enemyManager.createEnemies(),me.game.world.addChild(this.enemyManager,2),me.input.bindKey(me.input.KEY.LEFT,"left"),me.input.bindKey(me.input.KEY.RIGHT,"right"),me.input.bindKey(me.input.KEY.A,"left"),me.input.bindKey(me.input.KEY.D,"right"),me.input.bindKey(me.input.KEY.SPACE,"shoot",!0)},onDestroyEvent:function(){me.input.unbindKey(me.input.KEY.LEFT),me.input.unbindKey(me.input.KEY.RIGHT),me.input.unbindKey(me.input.KEY.A),me.input.unbindKey(me.input.KEY.D),me.input.unbindKey(me.input.KEY.SPACE)}});